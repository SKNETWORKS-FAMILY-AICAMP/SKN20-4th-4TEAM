{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìƒˆ ì‚¬ì—…ê³„íšì„œ ì‘ì„± | Boss Baby AI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { 
            background: linear-gradient(180deg, #e8f4fc 0%, #d0ebf7 100%);
            font-family: 'Noto Sans KR', sans-serif;
            min-height: 100vh;
        }
        .navbar {
            background: rgba(255,255,255,0.95) !important;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0,168,232,0.1);
        }
        .navbar-brand {
            font-size: 1.25rem;
            font-weight: 700;
            color: #00a8e8 !important;
        }
        .card {
            border: none;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            background: rgba(255,255,255,0.95);
        }
        .btn-primary {
            background: linear-gradient(135deg, #00a8e8 0%, #0077b3 100%);
            border: none;
            border-radius: 12px;
            padding: 14px 32px;
            font-weight: 600;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 168, 232, 0.3);
            background: linear-gradient(135deg, #00b8f8 0%, #0088cc 100%);
        }
        .btn-outline-secondary {
            border-radius: 12px;
            padding: 14px 32px;
            font-weight: 600;
        }
        .form-control, .form-select, textarea.form-control {
            border-radius: 10px;
            border: 2px solid #e9ecef;
            padding: 14px 18px;
            font-size: 1rem;
        }
        .form-control:focus, .form-select:focus {
            border-color: #00a8e8;
            box-shadow: 0 0 0 0.2rem rgba(0, 168, 232, 0.15);
        }
        textarea.form-control {
            min-height: 100px;
            line-height: 1.6;
        }
        .form-label {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        .required-mark {
            color: #e74c3c;
        }
        .optional-mark {
            color: #95a5a6;
            font-size: 0.9em;
            font-weight: 400;
        }
        .page-header {
            text-align: center;
            margin-bottom: 40px;
        }
        .page-header h2 {
            color: #2c3e50;
            font-weight: 700;
            margin-bottom: 12px;
        }
        .page-header p {
            color: #7f8c8d;
            font-size: 1.1rem;
        }
        .section-divider {
            border-top: 2px solid #e9ecef;
            margin: 35px 0 30px 0;
            padding-top: 25px;
        }
        .section-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #00a8e8;
            margin-bottom: 20px;
        }
        .info-box {
            background: #f8f9fa;
            border-left: 4px solid #00a8e8;
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
        }

        /* Boss Baby ìºë¦­í„° */
        .character-fixed {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 100px;
            z-index: 100;
            filter: drop-shadow(0 5px 15px rgba(0,0,0,0.3));
            transition: transform 0.3s;
        }
        .character-fixed:hover {
            transform: scale(1.1);
        }
        .character-fixed img {
            width: 100%;
        }
        .info-box h6 {
            color: #2c3e50;
            font-weight: 700;
            margin-bottom: 15px;
        }
        .info-box ul {
            margin: 0;
            padding-left: 20px;
        }
        .info-box li {
            color: #34495e;
            margin-bottom: 8px;
            line-height: 1.6;
        }
        .char-count {
            text-align: right;
            font-size: 0.85rem;
            color: #95a5a6;
            margin-top: 4px;
        }
    </style>
</head>
<body>
    <!-- Boss Baby ìºë¦­í„° -->
    <div class="character-fixed">
        <img src="{% static 'bossbaby.png' %}" alt="Boss Baby">
    </div>

    <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container">
            <a class="navbar-brand" href="/chat/">ğŸš€ Boss Baby AI</a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/chat/">ì±„íŒ…</a>
                <a class="nav-link" href="/my-chats/">ë‚´ ì±„íŒ…</a>
                <a class="nav-link" href="/mypage/">ë§ˆì´í˜ì´ì§€</a>
                <a class="nav-link" href="#" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</a>
            </div>
        </div>
    </nav>

    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-body p-5">
                        <div class="page-header">
                            <h2>ìƒˆ ì‚¬ì—…ê³„íšì„œ ì‘ì„±</h2>
                        <p>ê¸°ë³¸ ì •ë³´ë¥¼ ì…ë ¥í•˜ê³  ì‚¬ì—…ê³„íšì„œë¥¼ ì‘ì„±í•˜ì„¸ìš”. ì‘ì„± ì™„ë£Œ í›„ AI ì „ë¬¸ê°€ ë¶„ì„ì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                        {% if error %}
                            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                                {{ error }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>
                        {% endif %}

                        <form method="post" id="createForm">
                            {% csrf_token %}
                            
                            <!-- ê¸°ë³¸ ì •ë³´ ì„¹ì…˜ -->
                            <div class="section-title">ğŸ“‹ ê¸°ë³¸ ì •ë³´</div>
                            
                            <div class="mb-4">
                                <label for="title" class="form-label">
                                    ê³„íšì„œ ì œëª© <span class="required-mark">*</span>
                                </label>
                                <input type="text" class="form-control" id="title" name="title" 
                                       placeholder="ì˜ˆ: 2025 AI ê¸°ë°˜ êµìœ¡ í”Œë«í¼ ì‚¬ì—…ê³„íšì„œ" required>
                            </div>

                            <div class="mb-4">
                                <label for="business_name" class="form-label">
                                    ì‚¬ì—…ëª…/íšŒì‚¬ëª… <span class="required-mark">*</span>
                                </label>
                                <input type="text" class="form-control" id="business_name" name="business_name" 
                                       placeholder="ì˜ˆ: ì—ë“€í…Œí¬ ì£¼ì‹íšŒì‚¬" required>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-4">
                                    <label for="business_type" class="form-label">
                                        ì‚¬ì—… ë¶„ì•¼ <span class="required-mark">*</span>
                                    </label>
                                    <select class="form-select" id="business_type" name="business_type" required>
                                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                        <option value="tech">ê¸°ìˆ ì°½ì—…</option>
                                        <option value="service">ì„œë¹„ìŠ¤ì—…</option>
                                        <option value="manufacturing">ì œì¡°ì—…</option>
                                        <option value="retail">ìœ í†µ/ì†Œë§¤</option>
                                        <option value="food">ìŒì‹/ì™¸ì‹</option>
                                        <option value="education">êµìœ¡</option>
                                        <option value="healthcare">í—¬ìŠ¤ì¼€ì–´</option>
                                        <option value="finance">í•€í…Œí¬</option>
                                        <option value="other">ê¸°íƒ€</option>
                                    </select>
                                </div>

                                <div class="col-md-6 mb-4">
                                    <label for="current_stage" class="form-label">
                                        í˜„ì¬ ë‹¨ê³„ <span class="required-mark">*</span>
                                    </label>
                                    <select class="form-select" id="current_stage" name="current_stage" required>
                                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                        <option value="idea">ì•„ì´ë””ì–´ ë‹¨ê³„</option>
                                        <option value="planning">ê³„íš ìˆ˜ë¦½</option>
                                        <option value="prototype">í”„ë¡œí† íƒ€ì…</option>
                                        <option value="mvp">MVP ê°œë°œ</option>
                                        <option value="launch">ì¶œì‹œ ì¤€ë¹„</option>
                                        <option value="operating">ìš´ì˜ ì¤‘</option>
                                    </select>
                                </div>
                            </div>

                            <!-- ì‚¬ì—… ê°œìš” ì„¹ì…˜ -->
                            <div class="section-divider">
                                <div class="section-title">ğŸ’¡ ì‚¬ì—… ê°œìš” (AIê°€ ì°¸ê³ í•  ì •ë³´)</div>
                            </div>

                            <div class="mb-4">
                                <label for="business_idea" class="form-label">
                                    ì‚¬ì—… ì•„ì´ë””ì–´ ê°„ë‹¨ ì„¤ëª… <span class="required-mark">*</span>
                                </label>
                                <textarea class="form-control" id="business_idea" name="business_idea" 
                                          placeholder="ì˜ˆ: AI ê¸°ìˆ ì„ í™œìš©í•œ ë§ì¶¤í˜• ì˜¨ë¼ì¸ êµìœ¡ í”Œë«í¼ì…ë‹ˆë‹¤. í•™ìƒì˜ í•™ìŠµ íŒ¨í„´ì„ ë¶„ì„í•˜ì—¬ ê°œì¸ë³„ ìµœì í™”ëœ ì»¤ë¦¬í˜ëŸ¼ì„ ì œê³µí•©ë‹ˆë‹¤." 
                                          required maxlength="500" oninput="updateCharCount('business_idea', 500)"></textarea>
                                <div class="char-count" id="business_idea_count">0 / 500ì</div>
                            </div>

                            <div class="mb-4">
                                <label for="main_product" class="form-label">
                                    ì£¼ìš” ì œí’ˆ/ì„œë¹„ìŠ¤ <span class="required-mark">*</span>
                                </label>
                                <textarea class="form-control" id="main_product" name="main_product" 
                                          placeholder="ì˜ˆ: AI í•™ìŠµ ì¶”ì²œ ì‹œìŠ¤í…œ, ì‹¤ì‹œê°„ í™”ìƒ ê³¼ì™¸, í•™ìŠµ ì§„ë„ ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ" 
                                          required maxlength="300" oninput="updateCharCount('main_product', 300)"></textarea>
                                <div class="char-count" id="main_product_count">0 / 300ì</div>
                            </div>

                            <div class="mb-4">
                                <label for="target_customer" class="form-label">
                                    íƒ€ê²Ÿ ê³ ê° <span class="required-mark">*</span>
                                </label>
                                <textarea class="form-control" id="target_customer" name="target_customer" 
                                          placeholder="ì˜ˆ: ì´ˆÂ·ì¤‘Â·ê³ ë“±í•™ìƒ ë° í•™ë¶€ëª¨, íŠ¹íˆ ê°œì¸ ë§ì¶¤í˜• êµìœ¡ì„ ì›í•˜ëŠ” ê°€ì •" 
                                          required maxlength="300" oninput="updateCharCount('target_customer', 300)"></textarea>
                                <div class="char-count" id="target_customer_count">0 / 300ì</div>
                            </div>

                            <div class="mb-4">
                                <label for="differentiation" class="form-label">
                                    ì°¨ë³„í™” í¬ì¸íŠ¸/ê²½ìŸ ìš°ìœ„ <span class="required-mark">*</span>
                                </label>
                                <textarea class="form-control" id="differentiation" name="differentiation" 
                                          placeholder="ì˜ˆ: ê¸°ì¡´ ì˜¨ë¼ì¸ ê°•ì˜ì™€ ë‹¬ë¦¬ AIê°€ í•™ìƒì˜ ì´í•´ë„ë¥¼ ì‹¤ì‹œê°„ ë¶„ì„í•˜ì—¬ ë‚œì´ë„ë¥¼ ìë™ ì¡°ì ˆí•©ë‹ˆë‹¤. íŠ¹í—ˆ ì¶œì› ì™„ë£Œ." 
                                          required maxlength="400" oninput="updateCharCount('differentiation', 400)"></textarea>
                                <div class="char-count" id="differentiation_count">0 / 400ì</div>
                            </div>

                            <!-- ì¬ë¬´ ì •ë³´ (ì„ íƒ) -->
                            <div class="section-divider">
                                <div class="section-title">ğŸ’° ì¬ë¬´ ì •ë³´ <span class="optional-mark">(ì„ íƒì‚¬í•­)</span></div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-4">
                                    <label for="required_funding" class="form-label">
                                        í•„ìš” ìê¸ˆ (ì›) <span class="optional-mark">(ì„ íƒ)</span>
                                    </label>
                                    <input type="text" class="form-control" id="required_funding" name="required_funding" 
                                           placeholder="ì˜ˆ: 50,000,000">
                                    <small class="text-muted">ì´ˆê¸° ì°½ì—… ë˜ëŠ” ìš´ì˜ì— í•„ìš”í•œ ì´ ìê¸ˆ</small>
                                </div>

                                <div class="col-md-6 mb-4">
                                    <label for="revenue_plan" class="form-label">
                                        ìˆ˜ìµ ëª¨ë¸ <span class="optional-mark">(ì„ íƒ)</span>
                                    </label>
                                    <input type="text" class="form-control" id="revenue_plan" name="revenue_plan" 
                                           placeholder="ì˜ˆ: ì›” êµ¬ë…ë£Œ ëª¨ë¸ (ê¸°ë³¸ 9,900ì›)">
                                    <small class="text-muted">ì–´ë–»ê²Œ ìˆ˜ìµì„ ì°½ì¶œí•  ê³„íšì¸ì§€</small>
                                </div>
                            </div>

                            <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-5">
                                <a href="/business-plans/" class="btn btn-outline-secondary">
                                    ì·¨ì†Œ
                                </a>
                                <button type="submit" class="btn btn-primary">
                                    ì‚¬ì—…ê³„íšì„œ ìƒì„±
                                </button>
                            </div>
                        </form>

                        <div class="info-box">
                            <h6>ğŸ“‹ ì‚¬ì—…ê³„íšì„œ ì‘ì„± ì•ˆë‚´</h6>
                            <ul>
                                <li><strong>ê¸°ë³¸ì •ë³´:</strong> ì‚¬ì—…ëª…, ë¶„ì•¼, ë‹¨ê³„ ë“± ê¸°ë³¸ ì •ë³´</li>
                                <li><strong>ì‚¬ì—…ê°œìš”:</strong> ì•„ì´ë””ì–´, ì œí’ˆ/ì„œë¹„ìŠ¤, íƒ€ê²Ÿ ê³ ê°, ì°¨ë³„í™” í¬ì¸íŠ¸</li>
                                <li><strong>ì¬ë¬´ì •ë³´:</strong> í•„ìš” ìê¸ˆ, ìˆ˜ìµ ëª¨ë¸ (ì„ íƒì‚¬í•­)</li>
                                <li><strong>AI ë¶„ì„:</strong> ì‘ì„± ì™„ë£Œ í›„ ì „ë¬¸ê°€ AIì˜ ë¶„ì„ ë° í”¼ë“œë°± ì œê³µ</li>
                            </ul>
                            <p class="mb-0 mt-3" style="color: #7f8c8d;"><small>â€» ì •ë³´ë¥¼ ìƒì„¸íˆ ì…ë ¥í• ìˆ˜ë¡ ë” ì •í™•í•œ AI ë¶„ì„ì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤</small></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        async function logout() {
            try {
                const response = await fetch('/api/logout/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                });
                
                if (response.ok) {
                    window.location.href = '/';
                }
            } catch (error) {
                console.error('ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨:', error);
            }
        }

        // ê¸€ì ìˆ˜ ì¹´ìš´íŠ¸
        function updateCharCount(fieldId, maxLength) {
            const field = document.getElementById(fieldId);
            const countEl = document.getElementById(fieldId + '_count');
            const currentLength = field.value.length;
            countEl.textContent = `${currentLength} / ${maxLength}ì`;
            
            if (currentLength > maxLength * 0.9) {
                countEl.style.color = '#e74c3c';
            } else {
                countEl.style.color = '#95a5a6';
            }
        }

        // ìˆ«ì í•„ë“œ í¬ë§·íŒ…
        document.getElementById('required_funding')?.addEventListener('input', function() {
            let value = this.value.replace(/[^\d]/g, '');
            if (value) {
                value = parseInt(value).toLocaleString();
            }
            this.value = value;
        });

        // í¼ ìœ íš¨ì„± ê²€ì‚¬
        document.getElementById('createForm').addEventListener('submit', function(e) {
            const requiredFields = [
                'title', 'business_name', 'business_type', 'current_stage',
                'business_idea', 'main_product', 'target_customer', 'differentiation'
            ];
            
            let isValid = true;
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    isValid = false;
                    field.classList.add('is-invalid');
                } else {
                    field.classList.remove('is-invalid');
                }
            });

            if (!isValid) {
                e.preventDefault();
                alert('âš ï¸ ëª¨ë“  í•„ìˆ˜ í•­ëª©(*)ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                // ì²« ë²ˆì§¸ ë¹ˆ í•„ë“œë¡œ ìŠ¤í¬ë¡¤
                const firstInvalid = document.querySelector('.is-invalid');
                if (firstInvalid) {
                    firstInvalid.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
                return false;
            }
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ê¸€ì ìˆ˜ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            ['business_idea', 'main_product', 'target_customer', 'differentiation'].forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    const maxLength = parseInt(field.getAttribute('maxlength'));
                    updateCharCount(fieldId, maxLength);
                }
            });
        });
    </script>
</body>
</html>