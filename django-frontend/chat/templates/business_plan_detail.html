{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ plan.title }} | Boss Baby AI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { 
            background: linear-gradient(180deg, #e8f4fc 0%, #d0ebf7 100%);
            font-family: 'Noto Sans KR', sans-serif;
            min-height: 100vh;
        }
        .navbar {
            background: rgba(255,255,255,0.95) !important;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0,168,232,0.1);
        }
        .navbar-brand {
            font-size: 1.25rem;
            font-weight: 700;
            color: #00a8e8 !important;
        }
        .card {
            border: none;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            background: rgba(255,255,255,0.95);
            margin-bottom: 25px;
        }
        
        /* í—¤ë” ì¹´ë“œ */
        .header-card {
            background: linear-gradient(135deg, #00a8e8 0%, #0077b3 100%);
            color: white;
        }
        .header-card h3 {
            font-weight: 700;
            margin-bottom: 8px;
        }
        .header-info {
            opacity: 0.95;
            font-size: 1rem;
        }
        
        /* AI ë¶„ì„ ë²„íŠ¼ */
        .ai-action-box {
            background: linear-gradient(135deg, #00a8e8 0%, #0077b3 100%);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        .ai-action-box h4 {
            font-weight: 700;
            margin-bottom: 12px;
        }
        .ai-action-box p {
            opacity: 0.95;
            margin-bottom: 25px;
            font-size: 1.05rem;
        }
        .btn-ai-magic {
            background: white;
            color: #00a8e8;
            border: none;
            border-radius: 12px;
            padding: 16px 40px;
            font-weight: 700;
            font-size: 1.1rem;
            transition: all 0.3s;
        }
        .btn-ai-magic:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }
        .btn-ai-magic:disabled {
            opacity: 0.7;
        }
        
        /* í¼ ìŠ¤íƒ€ì¼ */
        .form-section {
            margin-bottom: 30px;
        }
        .form-section-title {
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #e9ecef;
        }
        .form-control, .form-select {
            border-radius: 10px;
            border: 2px solid #e9ecef;
            padding: 14px 18px;
            font-size: 1rem;
        }
        .form-control:focus, .form-select:focus {
            border-color: #00a8e8;
            box-shadow: 0 0 0 0.2rem rgba(0, 168, 232, 0.15);
        }
        textarea.form-control {
            min-height: 150px;
            line-height: 1.8;
        }
        .form-label {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        .form-text {
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        /* ë²„íŠ¼ */
        .btn-primary {
            background: linear-gradient(135deg, #00a8e8 0%, #0077b3 100%);
            border: none;
            border-radius: 12px;
            padding: 14px 32px;
            font-weight: 600;
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, #00b8f8 0%, #0088cc 100%);
        }
        .btn-outline-secondary {
            border-radius: 12px;
            padding: 14px 32px;
            font-weight: 600;
        }
        
        /* ì™„ì„±ë„ í‘œì‹œ */
        .completion-badge {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.95rem;
        }
        .completion-low {
            background: #fee;
            color: #c0392b;
        }
        .completion-medium {
            background: #fef3cd;
            color: #f39c12;
        }
        .completion-high {
            background: #d4edda;
            color: #27ae60;
        }
        
        /* íƒ­ */
        .nav-pills .nav-link {
            border-radius: 12px;
            padding: 12px 24px;
            margin-right: 10px;
            font-weight: 600;
            color: #7f8c8d;
        }
        .nav-pills .nav-link.active {
            background: linear-gradient(135deg, #00a8e8 0%, #0077b3 100%);
            color: white;
        }
        
        /* ì €ì¥ í”Œë¡œíŒ… ë²„íŠ¼ */
        .floating-save {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
        }
        .btn-save {
            background: linear-gradient(135deg, #00a8e8 0%, #0077b3 100%);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 16px 36px;
            font-weight: 700;
            font-size: 1.1rem;
            box-shadow: 0 8px 25px rgba(0, 168, 232, 0.4);
            transition: all 0.3s;
        }
        .btn-save:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(0, 168, 232, 0.5);
        }

        /* Boss Baby ìºë¦­í„° */
        .character-fixed {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 100px;
            z-index: 100;
            filter: drop-shadow(0 5px 15px rgba(0,0,0,0.3));
            transition: transform 0.3s;
        }
        .character-fixed:hover {
            transform: scale(1.1);
        }
        .character-fixed img {
            width: 100%;
        }
    </style>
</head>
<body>
    <!-- Boss Baby ìºë¦­í„° -->
    <div class="character-fixed">
        <img src="{% static 'bossbaby.png' %}" alt="Boss Baby">
    </div>

    <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container">
            <a class="navbar-brand" href="/chat/">ğŸš€ Boss Baby AI</a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/chat/">ì±„íŒ…</a>
                <a class="nav-link" href="/my-chats/">ë‚´ ì±„íŒ…</a>
                <a class="nav-link" href="/mypage/">ë§ˆì´í˜ì´ì§€</a>
                <a class="nav-link" href="#" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</a>
            </div>
        </div>
    </nav>

    <div class="container py-4">
        {% if success %}
            <div class="alert alert-success alert-dismissible fade show">
                âœ“ {{ success }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        {% endif %}
        
        {% if error %}
            <div class="alert alert-danger alert-dismissible fade show">
                âš  {{ error }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        {% endif %}

        <!-- í—¤ë” ì¹´ë“œ -->
        <div class="card header-card">
            <div class="card-body p-4">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <h3>{{ plan.title }}</h3>
                        <div class="header-info">
                            {{ plan.business_name }} Â· {{ plan.get_business_type_display }} Â· {{ plan.get_current_stage_display }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- AI ë¶„ì„ ì•¡ì…˜ë°•ìŠ¤ -->
        <div class="ai-action-box" id="aiActionBox">
            <h4>ğŸ“Š AI ì „ë¬¸ê°€ ë¶„ì„ì„ ë°›ì•„ë³´ì„¸ìš”</h4>
            <p>ì‘ì„±í•˜ì‹  ì‚¬ì—…ê³„íšì„œë¥¼ 20ë…„ ê²½ë ¥ ë²¤ì²˜íˆ¬ì ì „ë¬¸ê°€ AIê°€ ë¶„ì„í•©ë‹ˆë‹¤<br>
            ì‹œì¥ì„±, ì‹¤í˜„ê°€ëŠ¥ì„±, ê°•ì /ì•½ì , ë¦¬ìŠ¤í¬, ê°œì„  ì œì•ˆì„ ì œê³µí•©ë‹ˆë‹¤</p>
            <a href="{% url 'business_plan_analyze' plan.id %}" class="btn btn-ai-magic" id="aiAnalyzeBtn">
                ğŸ“Š AI ì „ë¬¸ê°€ ë¶„ì„ ë°›ê¸°
            </a>
        </div>

        <!-- í¸ì§‘ í¼ -->
        <form method="post" id="planForm">
            {% csrf_token %}
            
            <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
            <ul class="nav nav-pills mb-4" id="planTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="basic-tab" data-bs-toggle="pill" data-bs-target="#basic" type="button">
                        ğŸ“‹ ê¸°ë³¸ì •ë³´
                    </button>
                </li>
            </ul>

            <!-- íƒ­ ì»¨í…ì¸  -->
            <div class="tab-content" id="planTabsContent">
                
                <!-- ê¸°ë³¸ì •ë³´ íƒ­ -->
                <div class="tab-pane fade show active" id="basic" role="tabpanel">
                    <div class="card">
                        <div class="card-body p-4">
                            <div class="form-section-title">ğŸ“‹ ê¸°ë³¸ ì •ë³´</div>
                            
                            <div class="mb-4">
                                <label for="title" class="form-label">ê³„íšì„œ ì œëª©</label>
                                <input type="text" class="form-control" id="title" name="title" value="{{ plan.title }}">
                            </div>

                            <div class="mb-4">
                                <label for="business_name" class="form-label">ì‚¬ì—…ëª…/íšŒì‚¬ëª…</label>
                                <input type="text" class="form-control" id="business_name" name="business_name" value="{{ plan.business_name }}">
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-4">
                                    <label for="business_type" class="form-label">ì‚¬ì—… ë¶„ì•¼</label>
                                    <select class="form-select" id="business_type" name="business_type">
                                        <option value="tech" {% if plan.business_type == 'tech' %}selected{% endif %}>ê¸°ìˆ ì°½ì—…</option>
                                        <option value="service" {% if plan.business_type == 'service' %}selected{% endif %}>ì„œë¹„ìŠ¤ì—…</option>
                                        <option value="manufacturing" {% if plan.business_type == 'manufacturing' %}selected{% endif %}>ì œì¡°ì—…</option>
                                        <option value="retail" {% if plan.business_type == 'retail' %}selected{% endif %}>ìœ í†µ/ì†Œë§¤</option>
                                        <option value="food" {% if plan.business_type == 'food' %}selected{% endif %}>ìŒì‹/ì™¸ì‹</option>
                                        <option value="education" {% if plan.business_type == 'education' %}selected{% endif %}>êµìœ¡</option>
                                        <option value="healthcare" {% if plan.business_type == 'healthcare' %}selected{% endif %}>í—¬ìŠ¤ì¼€ì–´</option>
                                        <option value="finance" {% if plan.business_type == 'finance' %}selected{% endif %}>í•€í…Œí¬</option>
                                        <option value="other" {% if plan.business_type == 'other' %}selected{% endif %}>ê¸°íƒ€</option>
                                    </select>
                                </div>

                                <div class="col-md-6 mb-4">
                                    <label for="current_stage" class="form-label">í˜„ì¬ ë‹¨ê³„</label>
                                    <select class="form-select" id="current_stage" name="current_stage">
                                        <option value="idea" {% if plan.current_stage == 'idea' %}selected{% endif %}>ì•„ì´ë””ì–´ ë‹¨ê³„</option>
                                        <option value="planning" {% if plan.current_stage == 'planning' %}selected{% endif %}>ê³„íš ìˆ˜ë¦½</option>
                                        <option value="prototype" {% if plan.current_stage == 'prototype' %}selected{% endif %}>í”„ë¡œí† íƒ€ì…</option>
                                        <option value="mvp" {% if plan.current_stage == 'mvp' %}selected{% endif %}>MVP ê°œë°œ</option>
                                        <option value="launch" {% if plan.current_stage == 'launch' %}selected{% endif %}>ì¶œì‹œ ì¤€ë¹„</option>
                                        <option value="operating" {% if plan.current_stage == 'operating' %}selected{% endif %}>ìš´ì˜ ì¤‘</option>
                                    </select>
                                </div>
                            </div>

                            <div class="mb-4">
                                <label for="business_idea" class="form-label">ì‚¬ì—… ì•„ì´ë””ì–´ ì„¤ëª…</label>
                                <textarea class="form-control" id="business_idea" name="business_idea" placeholder="ì‚¬ì—… ì•„ì´ë””ì–´ë¥¼ êµ¬ì²´ì ìœ¼ë¡œ ì„¤ëª…í•´ì£¼ì„¸ìš”">{{ plan.business_idea }}</textarea>
                            </div>

                            <div class="mb-4">
                                <label for="main_product" class="form-label">ì£¼ìš” ì œí’ˆ/ì„œë¹„ìŠ¤</label>
                                <textarea class="form-control" id="main_product" name="main_product" placeholder="ì œê³µí•  ì£¼ìš” ì œí’ˆì´ë‚˜ ì„œë¹„ìŠ¤ë¥¼ ì„¤ëª…í•´ì£¼ì„¸ìš”">{{ plan.main_product }}</textarea>
                            </div>

                            <div class="mb-4">
                                <label for="target_customer" class="form-label">íƒ€ê²Ÿ ê³ ê°</label>
                                <textarea class="form-control" id="target_customer" name="target_customer" placeholder="ì£¼ìš” íƒ€ê²Ÿ ê³ ê°ì¸µì„ ì„¤ëª…í•´ì£¼ì„¸ìš”">{{ plan.target_customer }}</textarea>
                            </div>

                            <div class="mb-4">
                                <label for="differentiation" class="form-label">ì°¨ë³„í™” í¬ì¸íŠ¸</label>
                                <textarea class="form-control" id="differentiation" name="differentiation" placeholder="ê²½ìŸì‚¬ ëŒ€ë¹„ ì°¨ë³„í™” ìš”ì†Œë‚˜ ê²½ìŸ ìš°ìœ„ë¥¼ ì„¤ëª…í•´ì£¼ì„¸ìš”">{{ plan.differentiation }}</textarea>
                            </div>
                        </div>
                    </div>
                </div>


            </div>

            <!-- í•˜ë‹¨ ë²„íŠ¼ -->
            <div class="d-flex gap-2 justify-content-between mt-4">
                <a href="/business-plans/" class="btn btn-outline-secondary">â† ëª©ë¡ìœ¼ë¡œ</a>
                <div class="d-flex align-items-center gap-3">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="is_complete" id="is_complete" {% if plan.is_complete %}checked{% endif %}>
                        <label class="form-check-label" for="is_complete">
                            ì‘ì„± ì™„ë£Œ
                        </label>
                    </div>
                    <button type="submit" class="btn btn-primary" id="saveBtn">
                        ğŸ’¾ ì €ì¥í•˜ê¸°
                    </button>
                </div>
            </div>
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        async function logout() {
            try {
                const response = await fetch('/api/logout/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                });
                
                if (response.ok) {
                    window.location.href = '/';
                }
            } catch (error) {
                console.error('ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨:', error);
            }
        }

        // ìˆ«ì í•„ë“œ ì½¤ë§ˆ í¬ë§·íŒ…
        function formatNumber(input) {
            let value = input.value.replace(/[^\d]/g, '');
            if (value) {
                value = parseInt(value).toLocaleString();
            }
            input.value = value;
        }

        // ì¬ë¬´ ê´€ë ¨ ì…ë ¥ í•„ë“œì— ì½¤ë§ˆ ì¶”ê°€
        ['required_funding', 'expected_revenue_year1', 'expected_revenue_year3'].forEach(id => {
            const input = document.getElementById(id);
            if (input) {
                input.addEventListener('input', function() {
                    formatNumber(this);
                });
                // í˜ì´ì§€ ë¡œë“œì‹œ í¬ë§·íŒ…
                if (input.value) {
                    formatNumber(input);
                }
            }
        });

        // í¼ ì œì¶œ ì „ ì²˜ë¦¬
        document.getElementById('planForm').addEventListener('submit', function() {
            const submitBtn = document.getElementById('saveBtn');
            submitBtn.innerHTML = 'ğŸ’¾ ì €ì¥ ì¤‘...';
            submitBtn.disabled = true;
        });
    </script>
</body>
</html>